#!/bin/bash

# Define the source directory and destination file
SOURCE_DIR="myboardsshdir"
DEST_DIR="/home/root/.ssh"
DEST_FILE="$DEST_DIR/authorized_keys"

# Check if the source directory exists
if [ ! -d "$SOURCE_DIR" ]; then
    echo "Error: Source directory $SOURCE_DIR does not exist."
    exit 1
fi

# Create the .ssh directory if it does not exist
if [ ! -d "$DEST_DIR" ]; then
    mkdir -p "$DEST_DIR"
    if [ $? -ne 0 ]; then
        echo "Error: Failed to create directory $DEST_DIR."
        exit 1
    fi
fi

# Append all .pub files to the authorized_keys file
for pubkey in "$SOURCE_DIR"/*.pub; then
    if [ -f "$pubkey" ]; then
        cat "$pubkey" >> "$DEST_FILE"
    fi
done

# Set the correct permissions for the authorized_keys file
chmod 600 "$DEST_FILE"
chown root:root "$DEST_FILE"

echo "Public keys from $SOURCE_DIR have been appended to $DEST_FILE."
