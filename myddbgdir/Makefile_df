###############################################################################
# compiler setting
###############################################################################
GCOV_CFLAGS = -fprofile-arcs -ftest-coverage
CC          = gcc $(GCOV_CFLAGS)
CFLAGS      = -g -Wall -std=c99
LIBS        = -lm
INCPATH     =
DIR         = $(shell pwd)

###############################################################################
# source files setting
###############################################################################
C_SOURCES = $(shell find . -name "*.c")
C_OBJS    = $(patsubst %.c,%.o,$(wildcard $(C_SOURCES)))
OBJS      = $(C_OBJS)
EXEC      = $(shell basename $(DIR))

###############################################################################
.PHONY : clean clean_all
###############################################################################
all: $(EXEC)

%.o:%.c
        $(CC) $(CFLAGS) $(INCPATH) -c $< -o $@

$(EXEC): $(OBJS)
        $(CC) $(OBJS) -o $(EXEC) $(LIBS)

###############################################################################
clean:
        @rm -vfr $(OBJS)
clean_all: clean
        @rm -vfr $(EXEC) *.gcda *.gcno *.info
###############################################################################
CTAGS:
        ctags -R --c++-kinds=+p --fields=+iaS --extra=+q
###############################################################################
gen_coverage:
        geninfo .
        genhtml *.info -o coverage_result
###############################################################################

